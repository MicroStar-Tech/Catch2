From: Mathieu Mirmont <mat@parad0x.org>
Date: Tue, 29 Dec 2020 21:00:09 +0100
Subject: Make the build reproducible on g++ version 8+

Make the build reproducible by removing references to the source
directory from the Catch2WithMain static library.

Forwarded: https://github.com/catchorg/Catch2/pull/2141
---
 CMakeLists.txt | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 4d57dd1..4ef1d9d 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -108,6 +108,12 @@ add_library(Catch2WithMain ${CMAKE_CURRENT_LIST_DIR}/src/catch_with_main.cpp)
 target_link_libraries(Catch2WithMain PUBLIC Catch2)
 add_library(Catch2::Catch2WithMain ALIAS Catch2WithMain)
 
+# Make the build reproducible on versions of g++ that supports -ffile-prefix-map
+if("${CMAKE_CXX_COMPILER_ID}" STREQUAL "GNU")
+  if(NOT CMAKE_CXX_COMPILER_VERSION VERSION_LESS 8)
+    target_compile_options(Catch2WithMain PRIVATE "-ffile-prefix-map=${CMAKE_SOURCE_DIR}=.")
+  endif()
+endif()
 
 # Only perform the installation steps when Catch is not being used as
 # a subproject via `add_subdirectory`, or the destinations will break,
